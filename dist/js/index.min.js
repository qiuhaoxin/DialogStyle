!function(t,i){var s=i.documentElement,o=t.devicePixelRatio||1;function e(){s.clientWidth;s.style.fontSize="20px"}!function t(){i.body?i.body.style.fontSize=12*o+"px":i.addEventListener("DOMContentLoaded",t)}(),e(),window.addEventListener("resize",e),window.addEventListener("pageshow",function(t){if(2<=o){var e=i.createElement("body"),n=i.createElement("div");n.style.border=".5px solid transparent",e.appendChild(n),s.appendChild(e),1===n.offsetHeight&&s.classList.add("hairlines"),s.removeChild(e)}})}(window,document),function(t,e){"function"==typeof define&&define.amd?define([],e):"undefined"!=typeof module&&module.exports?module.exports=e():t.Socket=e()}(this,function(){if(!(!1 in window))return u.prototype={eventObj:{},onopen:function(t){},onclose:function(t){},onconnecting:function(t){},onmessage:function(t){this.eventObj.onmessage&&this.eventObj.onmessage(t.data)},onerror:function(t){},setEventCallBack:function(t){if(console.log("arguments is "+arguments.length),1<arguments.length)this.eventObj[t]=arguments[1];else for(var e in t)this.eventObj[e]=t[e]}},u.debugAll=!1,u.CONNECTING=WebSocket.CONNECTING,u.OPEN=WebSocket.OPEN,u.CLOSED=WebSocket.CLOSED,u.CLOSING=WebSocket.CLOSING,u;function u(t,e,n){var i={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};for(var s in n||(n={}),i)void 0!==n[s]?this[s]=n[s]:this[s]=i[s];this.url=t,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var o,a=this,r=!1,c=!1,l=document.createElement("div");function d(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}l.addEventListener("open",function(t){a.onopen(t)}),l.addEventListener("close",function(t){a.onclose(t)}),l.addEventListener("message",function(t){console.log("onmessage"),a.onmessage(t)}),l.addEventListener("error",function(t){a.onerror(t)}),l.addEventListener("connecting",function(t){a.onconnecting(t)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(i){if((o=new WebSocket(a.url,e||[])).binaryType=this.binaryType,i){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else l.dispatchEvent(d("connecting")),this.reconnectAttempt=0;(a.debug||u.debugAll)&&console.debug("Socket");var t=o,n=setTimeout(function(){c=!0,t.close(),c=!1},a.timeoutInterval);o.onopen=function(t){clearTimeout(n),(a.debug||u.debugAll)&&console.debug("Socket","onopen",a.url),a.protocol=o.protocol,a.readyState=WebSocket.OPEN,a.reconnectAttempts=0;var e=d("open");e.isReconnect=!1,l.dispatchEvent(e)},o.onclose=function(t){if(clearTimeout(n),o=null,r)a.readyState=WebSocket.CLOSED,l.dispatchEvent(d("close"));else{a.readyState=WebSocket.CONNECTING;var e=d("connecting");e.code=t.code,e.reason=t.reason,e.wasClean=t.wasClean,l.dispatchEvent(e),i||c||((a.debug||u.debugAll)&&console.debug("ReconnectingWebSocket","onclose",a.url),l.dispatchEvent(d("close")));var n=a.reconnectInterval*Math.pow(a.reconnectDecay,a.reconnectAttempts);setTimeout(function(){a.reconnectAttempts++,a.open(!0)},n>a.maxReconnectInterval?a.maxReconnectInterval:n)}},o.onmessage=function(t){(a.debug||u.debugAll)&&console.debug("Socket","onmessage",a.url,t.data);var e=d("message");e.data=t.data,l.dispatchEvent(e)},o.onerror=function(t){(a.debug||u.debugAll)&&console.debug("Socket","onerror",a.url,t),l.dispatchEvent(d("error"))}},this.automaticOpen&&this.open(!1),this.send=function(t){if(console.log("hei send data is "+t),o)return(a.debug||u.debugAll)&&console.debug("Socket","send",a.url,t),o.send(t);throw"INVALID_STATE_ERR: Pasuing to reconnect!"},this.close=function(t,e){void 0===t&&(t=1e3),r=!0,o&&o.close(t,e)},this.refresh=function(){o&&o.close()}}}),function(t,e){"function"==typeof define&&define.amd?define([],e):"undefined"!=typeof module&&module.exports?module.exports=e():t.ChatList=e()}(this,function(){function s(t){return document.getElementById(t)}var o=null,a=null,d=s("msg"),r=null,n=0,i=0,e=0,u=Math,h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1)},t=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,c=s("footer"),l=s("change"),m=s("voice"),p="touchstart",v="touchmove",g="touchend",f="transitionend";function b(t){this.$btn=s("submit"),a=s("list"),o=document.querySelector(".footer input"),window.message&&this.sendMessage(window.message);var e=document.location,n="ws:";"https:"==e.protocol&&(n="wss:");var i=n+e.host+window.context+"/ws/api/chatbot";console.log("address is "+i),(r=new Socket(i)).setEventCallBack("onmessage",this.acceptMsg.bind(this)),r.open(),d.style.transitionDuration="0",d.style.transformOrigin="0 0",d.style.transitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)",this.init()}return b.prototype={x:0,y:0,options:{useTransform:!0,bounce:!0,topOffset:0,bounceLock:!0,hScroll:!0,vScroll:!0,useTransition:!0},handleEvent:function(t){switch(t.type){case p:this.start(t);break;case v:this.move(t);break;case g:this.end(t);break;case f:this._transitionEnd(t)}},_transitionEnd:function(t){t.target==d&&(this.unbindEvent(d,f),this._startAni())},start:function(t){var e=t.touches[0]||t,n=this;n.moved=!1,n.animating=!1,n.options.useTransition&&n._transitionTime(0),n.distX=0,n.distY=0,n.dirX=0,n.dirY=0,n.startX=n.x,n.startY=n.y,n.pointX=e.pageX,n.pointY=e.pageY,n.startTime=t.timeStamp||Date.now(),this.bindEvent(d,v),this.bindEvent(d,g)},move:function(t){var e=t.touches[0]||t,n=e.pageX-this.pointX,i=e.pageY-this.pointY,s=this.x+n,o=this.y+i,a=t.timeStamp||Date.now();this.pointX=e.pageX,this.pointY=e.pageY,this.distX+=n,this.distY+=i,this.absDistX=Math.abs(this.distX),this.absDistY=Math.abs(this.distY),this.absDistY>this.absDistX+5?(s=this.x,n=0):this.absDistX>this.absDistY+5&&(o=this.y,i=0),this.moved=!0,console.log("move"+s+" and nweY is "+o),this._pos(s,o),this.dirX=0<n?-1:n<0?1:0,this.dirY=0<i?1:i<0?1:0,300<a-this.startTime&&(this.startTime=a,this.startX=this.x,this.startY=this.y)},end:function(t){var e,n,i,s=this,o=(t.changedTouches[0],{dist:0,time:0}),a={dist:0,time:0},r=(t.timeStamp||Date.now())-s.startTime,c=s.x,l=s.y;if(this.unbindEvent(d,v),this.unbindEvent(d,g),r<300&&(o=c?s._momentum(c-s.startX,r,-s.x,s.scrollerW-s.wrapperW+s.x,s.options.bounce?s.wrapperW:0):o,a=l?s._momentum(l-s.startY,r,-s.y,s.maxScrollY<0?s.scrollerH-s.wrapperH+s.y-s.minScrollY:0,s.options.bounce?s.wrapperH:0):a,c=s.x+o.dist,l=s.y+a.dist,(0<s.x&&0<c||s.x<s.maxScrollX&&c<s.maxScrollX)&&(o={dist:0,time:0}),(s.y>s.minScrollY&&l>s.minScrollY||s.y<s.maxScrollY&&l<s.maxScrollY)&&(a={dist:0,time:0})),o.dist||a.dist)return i=u.max(u.max(o.time,a.time),10),s.options.snap&&(e=c-s.absStartX,n=l-s.absStartY,u.abs(e)<s.options.snapThreshold&&u.abs(n)<s.options.snapThreshold?s.scrollTo(s.absStartX,s.absStartY,200):(snap=s._snap(c,l),c=snap.x,l=snap.y,i=u.max(snap.time,i))),void s.scrollTo(u.round(c),u.round(l),i);s._resetPos(100)},_resetPos:function(t){var e=this,n=0<=e.x?0:e.x<e.maxScrollX?e.maxScrollX:e.x,i=e.y>=e.minScrollY||0<e.maxScrollY?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y;n!=e.x||i!=e.y?e.scrollTo(n,i,t||0):e.moved&&(e.moved=!1,e.options.onScrollEnd&&e.options.onScrollEnd.call(e))},scrollTo:function(t,e,n,i){var s,o,a=this,r=t;for(a.stop(),r.length||(r=[{x:t,y:e,time:n,relative:i}]),s=0,o=r.length;s<o;s++)r[s].relative&&(r[s].x=a.x-r[s].x,r[s].y=a.y-r[s].y),a.steps.push({x:r[s].x,y:r[s].y,time:r[s].time||0});a._startAni()},_startAni:function(){var i,s,o,a=this,r=a.x,c=a.y,l=Date.now();if(!a.animating)if(a.steps.length){if((i=a.steps.shift()).x==r&&i.y==c&&(i.time=0),a.animating=!0,a.moved=!0,a.options.useTransition)return a._transitionTime(i.time),console.log("_startAni"),a._pos(i.x,i.y),a.animating=!1,void(i.time?a.bindEvent(d,f):a._resetPos(0));(o=function(){var t,e,n=Date.now();if(n>=l+i.time)return console.log("_startAni animate"),a._pos(i.x,i.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),void a._startAni();n=(n-l)/i.time-1,s=u.sqrt(1-n*n),t=(i.x-r)*s+r,e=(i.y-c)*s+c,console.log("_startAni animate2"),a._pos(t,e),console.log("animating is "+a.animating),a.animating&&(a.aniTime=h(o))})()}else a._resetPos(400)},_transitionTime:function(t){t+="ms",console.log("time is "+t),d.style.transitionDuration=t},stop:function(){this.options.useTransition?this.unbindEvent(d,f):t(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},init:function(){var e=this;n=this.wrapperH=document.body.clientHeight-44,this.wrapperW=document.body.clientWidth,this.$btn&&this.bindEvent(this.$btn,"click",this.sendMessage.bind(this)),o&&this.bindEvent(o,"keyup",function(t){t.preventDefault(),13==t.keyCode&&e.sendMessage()}),this.refresh(),this.bindEvent(m,"click",this.speak.bind(this)),this.bindEvent(l,"click",function(t){console.log("footer class is "+c.classList),console.log("result is "+c.classList.contains("change-lt")),console.log("targe class is "+t.target.classList);var e=t.target;e.classList.contains("icon-voice")?(e.classList.remove("icon-voice"),e.classList.add("icon-voice-text")):e.classList.contains("icon-voice-text")&&(e.classList.remove("icon-voice-text"),e.classList.add("icon-voice")),c.classList.contains("change-lt")?(c.classList.remove("change-lt"),c.classList.add("change-v"),i=1):c.classList.contains("change-v")&&(c.classList.remove("change-v"),c.classList.add("change-lt"),i=0)}),this.bindEvent(d,p)},acceptMsg:function(t){t=JSON.parse(t);var e=document.createElement("LI");e.classList.add("msg-item");var n='<div class="message new"><figure class="avatar left-avatar"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/156381/profile/profile-80.jpg" /></figure>'+t.text+"</div>";e.innerHTML=n,a.appendChild(e),this.refresh(),this.scroll()},scroll:function(){if(this.caculate(),n<e){var t=n-e;console.log("scrollTop is "+t),this._pos(0,t)}},caculate:function(){e=d.scrollHeight},refresh:function(){this.scrollerW=u.abs(a.offsetWidth),this.scrollerH=u.abs(a.offsetHeight),this.minScrollY=-this.options.topOffset||0,this.maxScrollX=this.wrapperW-this.scrollerW,this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY,this.hScroll=this.options.hScroll&&this.maxScrollX<0,this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH)},clearInput:function(){o.value=""},speakCallBack:function(t){alert(t.resultStr),this.sendMessage(t.resultStr)},speak:function(t){var e=this;if(navigator.userAgent.match(/Qing\/.*;(iOS|iPhone|Android).*/))try{XuntongJSBridge.call("voiceAssistant",{recommendLabelArr:["测试数据"],recommendButtonArr:[],imageStr:""},function(t){"true"==t.success?e.sendMessage(t.data.resultStr):alert("error is "+t.error)})}catch(t){alert("speak is "+t)}else alert("请用云之家打开!")},sendMessage:function(t){0==i&&(t=o.value,/^\s*$/.test(t))||(this.insertMsg(0,t),r.send(JSON.stringify({sessionId:window.chatSessionId,message:t})),this.clearInput(),this.refresh(),this.scroll())},setDate:function(){var t=new Date,e=document.createElement("DIV");return e.innerHTML=t.getHours()+":"+t.getMinutes(),e},insertMsg:function(t,e){var n=document.createElement("LI");n.classList.add("msg-item");var i='<div class="message message-personal"><figure class="avatar right-avatar"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/156381/profile/profile-80.jpg" /></figure>'+e+"</div>";n.innerHTML=i,a.appendChild(n)},bindEvent:function(t,e,n){t.addEventListener(e,n||this,!1)},unbindEvent:function(t,e,n){t.removeEventListener(e,n||this,!1)},_pos:function(t,e){console.log("this.hScroll is "+this.hScroll+" and vScroll is "+this.vScroll),t=this.hScroll?t:0,e=this.vScroll?e:0,this.options.useTransform?(console.log("test"),d.style["-webkit-transform"]="translate("+t+"px,"+e+"px)"):(t=u.round(t),e=u.round(e),d.style.left=t+"px",d.style.top=e+"px"),this.x=t,this.y=e},_momentum:function(t,e,n,i,s){var o,a=Math.abs(t)/e,r=a*a/.0012;return 0<t&&n<r?(a=a*(n+=s/(6/(r/a*6e-4)))/r,r=n):t<0&&i<r&&(a=a*(i+=s/(6/(r/a*6e-4)))/r,r=i),o=a/6e-4,{dist:r*=t<0?-1:1,time:Math.round(o)}}},b}),function(){if(!window.XuntongJSBridge){var r="xuntong",c=1,l={},t={invoke:e,call:e,handleMessageFromXT:function(t,e){try{var n=l[t];if(!n)return;n.apply(null,[e])}catch(t){alert(t)}}};window.XuntongJSBridge=t}function e(t,e,n){if(!(i=navigator.userAgent).match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&!i.match(/Android/i)&&!navigator.userAgent.match(/App\/cloudhub/))return!1;var i,s=n&&"function"==typeof n,o=s?c++:0;s&&(l[o]=n);var a=document.createElement("IFRAME");a.setAttribute("src",r+":"+t+":"+o+":"+encodeURIComponent(JSON.stringify(e))),a.setAttribute("height","1px"),a.setAttribute("width","1px"),document.documentElement.appendChild(a),a.parentNode.removeChild(a),a=null}}();